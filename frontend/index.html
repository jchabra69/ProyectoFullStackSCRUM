<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Clínica Dentista</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            background-color: #f1f1f1;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        h2 {
            color: #333;
            margin-top: 40px;
            margin-bottom: 20px;
        }

        form {
            margin-bottom: 30px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #666;
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #4CAF50;
            color: #fff;
        }

        @media only screen and (max-width: 768px) {
            body {
                padding: 10px;
            }
        }
    </style>
</head>
/* Conjunto de formularios HTML que proporcionan al usuario entradas de texto para al presionar los botones, se envie el formulario al servidor para realizar una búsqueda basada en el dato introducido. */
<body>
    <h1>Clínica Dem-Encía</h1>

    <h2>Lista de Pacientes</h2>
    <form id="listaPacientesForm">
        <label for="apellidosInput">Apellidos:</label>
        <input type="text" id="apellidosInput" name="apellidos">
        <button type="submit">Buscar</button>
    </form>
    <table id="pacientesTable">
        <!-- Aquí se mostrarán los resultados de la búsqueda -->
    </table>

    <h2>Lista de Tratamientos</h2>
    <form id="listaTratamientosForm">
        <label for="dniInput">DNI Paciente:</label>
        <input type="text" id="dniInput" name="dniPaciente">
        <button type="submit">Buscar</button>
    </form>
    <table id="tratamientosTable">
        <!-- Aquí se mostrarán los resultados de la búsqueda -->
    </table>

    <h2>Insertar Paciente</h2>
    <form id="insertPacienteForm">
        <label for="jsonPacienteInput">JSON Paciente:</label>
        <textarea id="jsonPacienteInput" name="jsonPaciente"></textarea>
        <button type="submit">Insertar</button>
    </form>

    <h2>Insertar Tratamiento</h2>
    <form id="insertTratamientoForm">
        <label for="jsonTratamientoInput">JSON Tratamiento:</label>
        <textarea id="jsonTratamientoInput" name="jsonTratamiento"></textarea>
        <button type="submit">Insertar</button>
    </form>

    <h2>Cobrar Tratamiento</h2>
    <form id="cobraTratamientoForm">
        <label for="codTratamientoInput">Código Tratamiento:</label>
        <input type="text" id="codTratamientoInput" name="codTratamiento">
        <label for="codPacienteInput">Código Paciente:</label>
        <input type="text" id="codPacienteInput" name="codPaciente">
        <button type="submit">Cobrar</button>
    </form>

    <script>
        //URL de la que obtenemos los datos
        const baseUrl = 'http://localhost:8081/index.html';

        // Listener listaPacientes
        document.getElementById('listaPacientesForm').addEventListener('submit', function (event) {
            event.preventDefault();
            // Obtiene el valor ingresado en el campo y lo guarda en una variable
            const apellidos = document.getElementById('apellidosInput').value;
            // URL para enviar la solicitud HTTP que controla los carácteres especiales
            const url = `${baseUrl}/listaPacientes?parametro=${encodeURIComponent(apellidos)}`;
            // Solicitud HTTP GET a la URL
            fetch(url)
                // Convierte la solicitud HTTP en JSON
                .then(response => response.json())
                .then(data => {
                    // Construye la tabla con los resultados
                    const table = document.getElementById('pacientesTable');
                    // Limpia la tabla anterior
                    table.innerHTML = ''; 
                    // Creamos un Array
                    const headers = ['ID', 'Nombre', 'Apellidos', 'DNI'];
                    const headerRow = document.createElement('tr');
                    headers.forEach(header => {
                        const th = document.createElement('th');
                        th.textContent = header;
                        headerRow.appendChild(th);
                    });
                    table.appendChild(headerRow);
                    // Itera sobre los elementos del array, que contiene los datos de los pacientes obtenidos del JSON
                    data.forEach(paciente => {
                        const row = document.createElement('tr');
                        // Se crea una celda para cada atributo del paciente (ID, nombre, apellidos, DNI) y se añaden los valores correspondientes
                        const idCell = document.createElement('td');
                        idCell.textContent = paciente.id;
                        const nombreCell = document.createElement('td');
                        nombreCell.textContent = paciente.nombre;
                        const apellidosCell = document.createElement('td');
                        apellidosCell.textContent = paciente.apellidos;
                        const dniCell = document.createElement('td');
                        dniCell.textContent = paciente.dni;
                        row.appendChild(idCell);
                        row.appendChild(nombreCell);
                        row.appendChild(apellidosCell);
                        row.appendChild(dniCell);
                        // Agrega la fila del paciente a la tabla
                        table.appendChild(row);
                    });
                })
                .catch(error => console.log(error));
        });

        // Listener listaTratamientos
        document.getElementById('listaTratamientosForm').addEventListener('submit', function (event) {
            event.preventDefault();
            // Obtiene el valor ingresado en el campo y lo guarda en una variable
            const dniPaciente = document.getElementById('dniInput').value;
            // URL para enviar la solicitud HTTP que controla los carácteres especiales
            const url = `${baseUrl}/listaTratamientos?parametro=${encodeURIComponent(dniPaciente)}`;
            // Solicitud HTTP GET a la URL
            fetch(url)
                // Convierte la solicitud HTTP en JSON
                .then(response => response.json())
                .then(data => {
                    // Construir la tabla con los resultados
                    const table = document.getElementById('tratamientosTable');
                    // Limpia la tabla anterior 
                    table.innerHTML = ''; 
                    // Creamos un Array
                    const headers = ['ID', 'Descripción', 'Fecha', 'Precio'];
                    const headerRow = document.createElement('tr');
                    headers.forEach(header => {
                        const th = document.createElement('th');
                        th.textContent = header;
                        headerRow.appendChild(th);
                    });
                    table.appendChild(headerRow);
                    // Itera sobre los elementos del array, que contiene los datos de los pacientes obtenidos del JSON
                    data.forEach(tratamiento => {
                        const row = document.createElement('tr');
                        // Se crea una celda para cada atributo del paciente (ID, nombre, apellidos, DNI) y se añaden los valores correspondientes
                        const idCell = document.createElement('td');
                        idCell.textContent = tratamiento.id;
                        const descripcionCell = document.createElement('td');
                        descripcionCell.textContent = tratamiento.descripcion;
                        const fechaCell = document.createElement('td');
                        fechaCell.textContent = tratamiento.fecha;
                        const precioCell = document.createElement('td');
                        precioCell.textContent = tratamiento.precio;
                        row.appendChild(idCell);
                        row.appendChild(descripcionCell);
                        row.appendChild(fechaCell);
                        row.appendChild(precioCell);
                        // Agrega la fila del paciente a la tabla
                        table.appendChild(row);
                    });
                })
                .catch(error => console.log(error));
        });

        /* Conjunto de Listeners que trabajan con el formulario del HTTP, obtienen el valor ingresado, crea una solicitud HTTP GET con los datos del paciente en formato JSON y lo muestra por consola */
        // Listener insertPaciente
        document.getElementById('insertPacienteForm').addEventListener('submit', function (event) {
            event.preventDefault();
            const jsonPaciente = document.getElementById('jsonPacienteInput').value;
            const url = `${baseUrl}/insertPaciente?parametro=${encodeURIComponent(jsonPaciente)}`;
            fetch(url)
                .then(response => response.json())
                .then(data => console.log(data))
                .catch(error => console.log(error));
        });

        // Listener insertTratamiento
        document.getElementById('insertTratamientoForm').addEventListener('submit', function (event) {
            event.preventDefault();
            const jsonTratamiento = document.getElementById('jsonTratamientoInput').value;
            const url = `${baseUrl}/insertTratamiento?parametro=${encodeURIComponent(jsonTratamiento)}`;
            fetch(url)
                .then(response => response.json())
                .then(data => console.log(data))
                .catch(error => console.log(error));
        });

        // Listener cobraTratamiento
        document.getElementById('cobraTratamientoForm').addEventListener('submit', function (event) {
            event.preventDefault();
            const codTratamiento = document.getElementById('codTratamientoInput').value;
            const codPaciente = document.getElementById('codPacienteInput').value;
            const url = `${baseUrl}/cobraTratamiento?parametro=${encodeURIComponent(codTratamiento)};${encodeURIComponent(codPaciente)}`;
            fetch(url)
                .then(response => response.json())
                .then(data => console.log(data))
                .catch(error => console.log(error));
        });
    </script>
</body>

</html>
